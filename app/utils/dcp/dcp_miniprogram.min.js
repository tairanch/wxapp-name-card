!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var a in o)("object"==typeof exports?exports:e)[a]=o[a]}}(window,function(){return o={},e.m=t=[function(e,t,o){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=o(1),n=o(2),c={autoTrackCustom:{appLaunch:function(e,t){r.collectPara.firstEnter=!0,c.isUpload(),c.collectError()},appShow:function(e,t){},appHide:function(e){},pageLoad:function(e){r.collectPara.launchTime=+new Date},pageShow:function(e){r.collectPara.insideTime=+new Date;var t="";if("object"==a(this)&&("string"==typeof this.route?t=this.route:"string"==typeof this.__route__&&(t=this.__route__)),r.collectPara.event[0]["X-Source-Url"]=r.sa_referrer?r.sa_referrer+"?appId="+r.collectPara.header["App-Id"]:"",r.collectPara.event[0]["X-Current-Url"]=t+"?appId="+r.collectPara.header["App-Id"],0!==Object.keys(r.sa_referrer_option).length&&(r.collectPara.event[0]["X-Source-Url"]+="&"+n.changeJSON2Query(r.sa_referrer_option)),this.dcpOptions&&0!==Object.keys(this.dcpOptions).length&&(r.collectPara.event[0]["X-Current-Url"]+="&"+n.changeJSON2Query(this.dcpOptions)),0!==Object.keys(this.options).length&&(r.collectPara.event[0]["X-Current-Url"]+="&"+n.changeJSON2Query(this.options)),r.collectPara.firstEnter)r.collectPara.firstEnter=!1,setTimeout(function(){r.collectPara.event[0].PageSessionID=n.getUUID();var e=JSON.parse(JSON.stringify(r.collectPara.event));e[0].Event="beforeload",e[0].CurrentTime=+new Date,c.send(e),r.collectPara.PageLoadedTime=+new Date-r.collectPara.launchTime,setTimeout(function(){e[0].PageLoadedTime=r.collectPara.PageLoadedTime,e[0].Event="loaded",e[0].CurrentTime=+new Date,c.send(e),r.sa_referrer=t},500)},300);else{r.collectPara.insideTime=+new Date,r.collectPara.event[0].PageSessionID=n.getUUID();var o=JSON.parse(JSON.stringify(r.collectPara.event));o[0].Event="insideload",o[0].CurrentTime=+new Date,o[0].PageLoadedTime=+new Date-r.collectPara.launchTime,r.storageInfo.seqNo++,c.send(o)}},pageHide:function(e){var t=JSON.parse(JSON.stringify(r.collectPara.event));t[0].Event="unload",t[0].PageStayTime=+new Date-r.collectPara.insideTime,t[0].CurrentTime=+new Date,r.sa_referrer=this.route,r.sa_referrer_option=this.dcpOptions||this.options,c.send(t),r.collectPara.event[0].PageTitle=""},pageUnload:function(e){var t=JSON.parse(JSON.stringify(r.collectPara.event));t[0].Event="unload",t[0].PageStayTime=+new Date-r.collectPara.insideTime,t[0].CurrentTime=+new Date,r.sa_referrer=this.route,r.sa_referrer_option=this.dcpOptions||this.options,c.send(t),r.collectPara.event[0].PageTitle=""}},init:function(e){e&&(r.collectPara.header["X-Auth"]=e.auth||"",r.collectPara.header["App-Id"]=e.appId||"",r.collectPara.event[0]["X-Code"]=e.channelCode||"",r.collectPara.event[0]["X-Auth"]=e.auth||"",r.is_plugin=e.is_plugin||!1,r.collectPara.collectUrl="https://collect.trc.com/rest/collect/h5/v2",r.collectPara.wsUrl="wss://collectapi.trc.com/socket/collect/v3",r.collectPara.isUploadUrl="https://collect.trc.com/rest/collect/isupload/app/v1/",c.getSystem(),c.rewriteApp())},rewriteApp:function(){if(r.is_plugin)c.App=function(e){i(e=e||{},"onLaunch","appLaunch"),i(e,"onShow","appShow"),i(e,"onHide","appHide"),App.apply(this,arguments)},c.Page=function(e){i(e,"onLoad","pageLoad"),i(e,"onShow","pageShow"),i(e,"onHide","pageHide"),i(e,"onUnload","pageUnload"),Page.apply(this,arguments)};else{var e=App;App=function(t){i(t,"onLaunch","appLaunch"),i(t,"onShow","appShow"),i(t,"onHide","appHide"),e.apply(this,arguments)};var t=Page;Page=function(e){i(e,"onLoad","pageLoad"),i(e,"onShow","pageShow"),i(e,"onHide","pageHide"),i(e,"onUnload","pageUnload"),t.apply(this,arguments)}}},collectError:function(){wx.onError(function(e){var t={type:"miniwx-error",summary:"miniwx-error thirdScriptError",message:{errror:e},url:r.collectPara.event[0]["X-Current-Url"]};c.dispatch("httpError",!1,t)})},openWebSocket:function(e){var t=this;wx.onSocketError(function(e){console.log("socket错误",e)}),wx.connectSocket({url:r.collectPara.wsUrl,success:function(){wx.onSocketOpen(function(o){r.collectPara.socketOpen=!0,e&&t.sendSocketMessage(e)})},fail:function(){console.log("socket连接failed")}})},dealParam:function(e){return r.storageInfo.DeviceId||(r.storageInfo=n.getStorage("dcpdata2019_wechat")||{},r.storageInfo.DeviceId||(r.storageInfo.DeviceId="miniwx|"+n.random())),6e5<=+new Date-+r.storageInfo.lastTime&&(r.storageInfo.AppSessionID=n.getUUID(),r.storageInfo.seqNo=1),r.collectPara.header["X-Device-Id"]||(r.collectPara.header["X-Device-Id"]=r.storageInfo.DeviceId),e[0].seqNo=r.storageInfo.seqNo,e[0].AppSessionID=r.storageInfo.AppSessionID,e[0].uuid=n.getUUID(),r.storageInfo.lastTime=+new Date+"",n.setStorage("dcpdata2019_wechat",r.storageInfo),r.collectPara.header["X-User-Id"]=r.collectPara.header["X-User-Id"]||n.getStorage("dcp_miniprogram_id"),e[0].PageTitle||(e[0].PageTitle=e[0]["X-Current-Url"].split("/").reverse()[0].split("?")[0]),{device:r.collectPara.device,event:e,header:r.collectPara.header}},sendSocketMessage:function(e){var t=this;wx.sendSocketMessage({data:JSON.stringify(this.dealParam(e)),success:function(){r.collectPara.event[0].ExtraInfo={},r.collectPara.event[0].PageElement&&delete r.collectPara.event[0].PageElement},fail:function(){t.sendHttpMessage(e),t.openWebSocket()}})},sendHttpMessage:function(e){var t=this.dealParam(e);wx.request({url:r.collectPara.collectUrl+"?dcpChannelCode="+r.collectPara.event[0]["X-Code"],method:"POST",data:{event:t.event,device:t.device},header:{"X-Auth":t.header["X-Auth"],"X-Device-Id":t.header["X-Device-Id"]||"","X-User-Id":t.header["X-User-Id"]||"",Network:t.header.Network||"","App-Version":t.header["App-Version"]||"","App-Id":t.header["App-Id"]||""},success:function(){r.collectPara.event[0].ExtraInfo={},r.collectPara.event[0].PageElement&&delete r.collectPara.event[0].PageElement}})},send:function(e){r.collectPara.collectParaSign&&(r.collectPara.socketOpen?this.sendSocketMessage(e):this.sendHttpMessage(e))},dispatch:function(e,t,o){var a=[].concat(r.collectPara.event);a[0].Event=e,a[0].ExtraInfo=o,t&&(a[0].PageElement="{nodeName:"+t.nodeName+",title:"+t.title+",text:"+t.innerHTML+"}"),c.send(a)},isUpload:function(){var e=this;if(!r.collectPara.event[0]["X-Code"]||!r.collectPara.header["X-Auth"])return r.collectPara.collectParaSign=!1;var t={dcpChannelCode:r.collectPara.event[0]["X-Code"],device:"app",random:Math.random()};wx.request({url:r.collectPara.isUploadUrl+"?"+n.changeJSON2Query(t),method:"GET",header:{"X-Auth":r.collectPara.header["X-Auth"],"content-type":"json"},success:function(t){var o=t.data.body;if(!o.isUpload)return r.collectPara.collectParaSign=!1;r.storageInfo=n.getStorage("dcpdata2019_wechat")||{},r.storageInfo.AppSessionID=n.getUUID(),r.storageInfo.DeviceId||(r.storageInfo.DeviceId="miniwx|"+n.random()),r.storageInfo.seqNo=1,r.storageInfo.lastTime=+new Date+"",n.setStorage("dcpdata2019_wechat",r.storageInfo),o.socket?e.openWebSocket():r.collectPara.socketOpen=!1}})},setPageTitle:function(e){e&&(r.collectPara.event[0].PageTitle=e)},getDeviceId:function(){return r.storageInfo.DeviceId||(r.storageInfo=n.getStorage("dcpdata2019_wechat")||{}),r.storageInfo.DeviceId},getSystem:function(){wx.getSystemInfo({success:function(e){var t=r.collectPara.device;t.ScreenHigh=e.screenHeight,t.ScreenWide=e.screenWidth,t.OperatingSystem=e.system.split(" ")[0],t.SystemVersion=e.system.split(" ")[1],t.DeviceBrand=e.brand,t.DeviceItemNo=e.model,r.collectPara.header["App-Version"]=e.SDKVersion}}),wx.getNetworkType({success:function(e){r.collectPara.header.Network=e.networkType}})},storedUserId:function(e){e?(r.collectPara.header["X-User-Id"]=e,n.setStorage("dcp_miniprogram_id",e)):n.setStorage("dcp_miniprogram_id","")}};function i(e,t,o){var a=c.autoTrackCustom[o];if(e[t]){var n=e[t];e[t]=function(){"onLaunch"===t&&(this[r.collectPara.name]=c),n.apply(this,arguments),a.apply(this,arguments)}}else e[t]=function(){"onLaunch"===t&&(this[r.collectPara.name]=c),a.apply(this,arguments)}}e.exports=c},function(e,t,o){"use strict";e.exports={storageInfo:{DeviceId:"",AppSessionID:"",lastTime:"",seqNo:1},is_plugin:!0,sa_referrer:"",sa_referrer_option:{},collectPara:{name:"dcp",collectParaSign:!0,socketSign:!0,socketOpen:!1,firstEnter:!1,launchTime:0,PageLoadedTime:0,insideTime:1e4,collectUrl:"https://testcollect.fengdai.org/rest/collect/h5/v2",wsUrl:"wss://testcollect.fengdai.org/socket/collect/v3",isUploadUrl:"https://testcollect.fengdai.org/rest/collect/isupload/app/v1/",device:{DeviceType:"miniprogram",Language:"zh-CN",ScreenHigh:0,ScreenWide:0},event:[{"X-Code":"","X-Auth":"",PageSessionID:"",Event:"",PageTitle:"",CurrentTime:1541497257740,AppSessionID:"1551687417082|6b760d93e1193d875e9dbad2b16b3b52","X-Current-Url":"","X-Source-Url":"",ExtraInfo:{},uuid:""}],header:{"X-Device-Id":"","X-User-Id":"","X-Auth":"","App-Id":"","App-Version":"2.2.0.2",Network:""}}}},function(e,t,o){"use strict";var a={isObject:function(e){return"[object Object]"==Object.prototype.toString.call(e)&&null!=e},getUUID:function(){return(new Date).getTime()+"|"+this.random()},random:function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},changeJSON2Query:function(e){var t="";for(var o in e)""!==t&&(t+="&"),t+=o+"="+encodeURIComponent(e[o]);return t},getStorage:function(e){return wx.getStorageSync(e)},setStorage:function(e,t){wx.setStorageSync(e,t)}};e.exports=a}],e.c=o,e.d=function(t,o,a){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:a})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&o&&"string"!=typeof t)for(var r in t)e.d(a,r,function(e){return t[e]}.bind(null,r));return a},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0);function e(a){if(o[a])return o[a].exports;var r=o[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var t,o});